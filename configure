#!/bin/sh


VERSION="1.6"
DD_VERSION="delphinusdnsd-$VERSION"
DD_VERSION_LEN=`echo -n $DD_VERSION | wc -c`
NP=0

echo "/* ddd-config.h - autogenerated by configure */" > ddd-config.h

until [ -z $1 ]
do
	case $1 in
		--location=*)
			location=`echo $1 | sed -e 's/--location=//g'`
			echo "#define DEFAULT_LOCATION \"$location\"" >> ddd-config.h
			echo "#define DEFAULT_CONFFILE \"${location}/etc/delphinusdns.conf\"" >> ddd-config.h
			echo "#define DEFAULT_RZONE_DIR \"${location}/replicant\"" >> ddd-config.h

			;;
		--user=*)
			user=`echo $1 | sed -e 's/--user=//g'`
			echo "#define DEFAULT_PRIVILEGE \"$user\"" >> ddd-config.h
			;;
		--without-setproctitle)
			echo "#define NO_SETPROCTITLE	1" >> ddd-config.h
			;;
		*)
			echo "usage: configure [--user=USERNAME] [--without-setproctitle] [--location=LOCATION]"
			exit
			;;
	esac
	shift
done

echo "#define DD_CONVERT_VERSION \"dd-convert $VERSION\"" >> ddd-config.h
echo "#define DD_VERSION \"$DD_VERSION\"" >> ddd-config.h
echo "#define DD_VERSION_LEN $DD_VERSION_LEN" >> ddd-config.h

openbsd() {
	echo configuring for OpenBSD
	cp Makefile.openbsd Makefile
	cp delphinusdnsd/Makefile.openbsd delphinusdnsd/Makefile
	cp dddctl/Makefile.openbsd dddctl/Makefile
}

netbsd() {
	echo configuring for NetBSD
	if [ ! -d /usr/pkg/libressl ]; then
		echo must install libressl in pkgsrc.  1>&2
		exit 1
	fi
	cp Makefile.netbsd Makefile
	cp delphinusdnsd/Makefile.netbsd delphinusdnsd/Makefile
	cp dddctl/Makefile.netbsd dddctl/Makefile
	
	if [ ! -d /usr/local/bin ] ; then
		echo WARN: before installing make sure /usr/local/bin exists!
	fi
	if [ ! -d /usr/local/sbin ] ; then
		echo WARN: before installing make sure /usr/local/sbin exists!
	fi
	if [ ! -d /usr/local/man/man/man8 ] ; then
		echo WARN: before installing make sure /usr/local/man/man/man8 exists!
	fi
	if [ ! -d /usr/local/man/man/man5 ] ; then
		echo WARN: before installing make sure /usr/local/man/man/man5 exists!
	fi
}

freebsd() {
	echo configuring for FreeBSD
	cp Makefile.freebsd Makefile
	cp delphinusdnsd/Makefile.freebsd delphinusdnsd/Makefile
	cp dddctl/Makefile.freebsd dddctl/Makefile
}

linux() {
	echo configuring for Linux
	cp Makefile.linux Makefile
}

darwin() {
	echo unfortunately mac os x has been disabled
}


case "`uname -s`" in
Darwin)
		darwin;
		;;
OpenBSD)
		openbsd;
		;;
FreeBSD)
		freebsd
		;;	
NetBSD)
		netbsd;
		;;
Linux)
		linux
	;;
esac

echo done.  Type make to make programs.
