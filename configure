#!/bin/sh


echo "/* ddd-config.h - autogenerated by configure */" > ddd-config.h

until [ -z $1 ]
do
	case $1 in
		--user=*)
			user=`echo $1 | sed -e 's/--user=//g'`
			echo "#define DEFAULT_PRIVILEGE \"$user\"" >> ddd-config.h
			;;
		*)
			echo "usage: configure [--user=USERNAME]"
			exit
			;;
	esac
	shift
done

openbsd() {
	echo configuring for OpenBSD
	cp Makefile.openbsd Makefile
	cp delphinusdnsd/Makefile.openbsd delphinusdnsd/Makefile
}

netbsd() {
	echo configuring for NetBSD
	cp Makefile.netbsd Makefile
}

freebsd() {
	echo configuring for FreeBSD
	cp Makefile.freebsd Makefile
}

linux() {
	echo configuring for Linux
	cp Makefile.linux Makefile

	# libressl

	if [ ! -d ../libressl-2.2.4 ] ; then
		echo Please install libressl-2.2.4 in the directory before this one!
		echo You can get it from http://ftp.openbsd.org/pub/OpenBSD/LibreSSL/
		echo "Please extract it and ./configure && make check, this will not "
		echo install it into your system only into that directory.
		echo
		echo Due to Linux distros not supporting libressl yet, we have to 
		echo make it this way, hopeing for someone making inroads one day!
		echo cleaning up...
		rm -f Makefile
		exit 1
	else
		echo Now making a symlink for libcrypto and libssl...
		ln -s ../libressl-2.2.4/crypto/.libs/libcrypto.a libressllibcrypto.a
		ln -s ../libressl-2.2.4/crypto/.libs/libcompat.a libressllibcompat.a
		ln -s ../libressl-2.2.4/ssl/.libs/libssl.a libressllibssl.a
		ln -s ../libressl-2.2.4/crypto/.libs/libcompatnoopt.a libressllibcompatnoopt.a
		echo done.	
	fi
}

darwin() {
	echo configuring for Darwin
	cp Makefile.macosx Makefile
}


case "`uname -s`" in
Darwin)
		darwin;
		;;
OpenBSD)
		openbsd;
		;;
FreeBSD)
		freebsd
		;;	
NetBSD)
		netbsd;
		;;
Linux)
		linux
	;;
esac

echo done.  Type make to make programs.
