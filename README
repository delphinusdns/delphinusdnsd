$Id: README,v 1.11 2016/01/01 08:24:31 pjp Exp $

1. README
2. WHY DELPHINUSDNS?
3. INSTALL HINTS
 3.1 Linux
 3.2 FreeBSD
 3.3 OpenBSD
 3.4 NetBSD
 3.5 Mac OS X
4. COMPATIBILITY
5. EXAMPLES
6. DNSSEC
 6.1 Preparing your computer for DNSSEC
 6.2 Signing your zone with dd-convert.rb
 6.3 re-signing with existing keys
 6.4 What to do with the .signed file
 6.5 How can I sub-delegate a zone with DNSSEC
7. WHAT IT CAN'T DO

1. README 
---------

Delphinusdns is a small authoritative nameserver.  It does not recurse nor 
search.  This program is written to a BSD Style License.  Sleepycat's 
BerkeleyDB is also used for the main in-memory database.

2. WHY DELPHINUSDNS?
-------------------

DNS is simple.  Yet implementation of DNS servers is not so simple.
Delphinusdns is written for research into the DNS system so that perhaps one
day the author has a better understanding of it.  Comparing delphinusdns to
other DNS implementations is not fair since many of those implementation
fix Delphinusdns's faults on the Internet.  It is recommended that if this
daemon is used on the Internet that logging be turned on to learn from it
and the DNS system.  

Use the tool "dig" that comes with bind9 to debug Delphinusdns.  If you like to 
program, then you can fork Delphinusdns and make your own creation, or you
can send patches to the author who may implement them into the code.


3. INSTALL HINTS
----------------

To install, type sh ./configure on BSD and just ./configure on Linux.  This
will copy the proper Makefile to ./Makefile.  Then you would type make, 
followed by su'ing and make install.  Delphinusdnsd installs to /usr/local/sbin.

By default installation the configuration file is not installed you need to
do this manually.  Also by default the config file is specified as 
/etc/delphinusdns.conf this can be changed by adding the -f option to 
delphinusdnsd.

A sample config file exists with the sources.  example7.conf was a real life
config once. 

3.1 Linux
---------

In Linux we rely on LibreSSL 2.2.4, you must download it (configure will 
tell you from where in ./configure) and place it in the directory besides 
delphinusdnsd root directory.  You do not have to install it but you have 
to './configure && make check' at least.

In Linux MINT you need to apt-get install build-essential.

## configure the platform
$ ./configure
## this will install the development programs you'll need (as root)
$ apt-get install bison cvs gcc libdb5.3-dev libssl-dev dnssec-tools
$ apt-get install ruby-2.0
## add a privsep user with a chroot directory (option -m) (as root)
$ useradd -m _ddd
## create the db directory (as root)
$ mkdir -p /var/db/delphinusdns
## make the program
$ make
## install the binary (as root)
$ make install
## done, create a config file and start delphinusdnsd


3.2 FreeBSD
-----------

## configure the platform
$ sh configure
## this will install the development programs you'll need (as root)
$ cd /usr/ports/databases/db5 && make install clean
## add a privsep user (_ddd) with a chroot directory (as root)
$ vipw
## or
$ adduser
## create the db directory (as root)
$ mkdir -p /var/db/delphinusdns
## make the program
$ make
## install the binary (as root)
$ make install
## done, create a config file and start delphinusdnsd

Jail users, if you get a:

Aug 18 13:43:47 io delphinusdnsd[54350]: starting up
Aug 18 13:43:47 io delphinusdnsd[54350]: dbenv->open failed: Function not implemented

Similar message, that's probably because your jail must be allowing sysvipc.
Set this:

jail_example_parameters="allow.sysvipc=1"

in your /etc/rc.conf and reboot the jail.


3.3 OpenBSD
-----------

## configure the platform
$ sh configure
## this will install the development programs you'll need (as root)
$ pkg_add db-4.6.21p0v0 isc-bind
## add a privsep user (_ddd) with a chroot directory (as root)
$ vipw
## or
$ adduser
## create the db directory (as root)
$ mkdir -p /var/db/delphinusdns
## make the program
$ make
## install the binary (as root)
$ make install
## done, create a config file and start delphinusdnsd

3.4 NetBSD
----------

The tests for this were done on NetBSD 6.1.5

## configure the platform
$ sh configure
## the following will install the development programs you'll need (as root)
$ cd /usr/pkgsrc/databases/db5 && make install
## add a privsep user with a chroot directory (as root)
$ useradd -m _ddd
## create the db directory (as root)
$ mkdir -p /var/db/delphinusdns
## make the program
$ make
## install the binary (as root)
$ make install
## done, create a config file and start delphinusdnsd

3.5 Mac OS X
------------

## configure for Mac OS X
$ sh configure
## Installed berkeley db 4.8 through Mac Ports.
$ sudo port install db48
## The binary is made with nobody as the unprivileged user
$ make
## cp the binary into /usr/local/sbin/
$ sudo cp delphinusdnsd /usr/local/sbin/
## make the /var/db/delphinusdns directory
$ mkdir -p /var/db/delphinusdns
## done, create config file and start delphinusdnsd


4. COMPATIBILITY
----------------

------------------+--------------------+---------------------+-------------+
Operating System**| makes and compiles | responds to queries | Berkeley DB |
------------------+--------------------+---------------------+-------------+
FreeBSD 10        |        yes         |       yes           | version 5   |
------------------+--------------------+---------------------+-------------+
NetBSD 6.1.5      |        yes*        |       yes           | version 5   |
------------------+--------------------+---------------------+-------------+
OpenBSD 5.6       |        yes         |       yes           | version 4.6 |
------------------+--------------------+---------------------+-------------+
Linux 		  |        yes         |       yes           | version 5   |
------------------+--------------------+---------------------+-------------+
Mac OS X ElCapitan|        yes         |       yes           | version 4.8 |
with MacPorts     |                    |                     |		   |	
------------------+--------------------+---------------------+-------------+
Rasbian OS        |        yes ***     |       yes           | version 5   |
------------------+--------------------+---------------------+-------------+

* there was a period in time that NetBSD didn't compile
** All Operating Systems require Berkeley DB 4.6 or higher.
*** Raspbian OS (Raspberry Pi) only has support for Berkeley DB 5.0 or higher

5. EXAMPLES
-----------

in the directory "examples" are a few examples from working configs.

6. DNSSEC
---------

DNSSEC is added hostmaster commitment.  You will have to re-sign your zone at
periodic intervals.  This can be automated though.

6.1 Preparing your computer for DNSSEC
--------------------------------------

What you need is the ISC Bind package or port.  In particular you need the 
programs dnssec-signzone and dnssec-keygen.

Also what you need to do is install ruby version 2.1 if you haven't already 
and then install the ruby gems dns-zone and etc, like so:

	gem install dns-zone --version '0.2.0'
	gem install etc
	
After that the dd-convert.rb which is in this install directory will function 
right.

6.2 Signing your zone with dd-convert.rb
----------------------------------------

The very first time you'll want to create ZSK and KSK keys.  They are the
zone signing and key signing keys respectively.  Every DNSSEC zone has at
least one of these.  To create these with dd-convert.rb I use -Z and -K
options.  Here is an example:

	./dd-convert.rb -Z -K -i centroid.eu -n centroid.eu

What this does is it creates the keys and signs the zone 'centroid.eu' with
the zonename centroid.eu.  No trailing dots are needed.  The output will be
called centroid.eu.signed and the keys will be created and look like this:

alpha$ ls K*
Kcentroid.eu.+008+04815.key             Kcentroid.eu.+008+40405.key
Kcentroid.eu.+008+04815.private         Kcentroid.eu.+008+40405.private

This is the output format of dnssec-keygen utility and format is simple:

K for key, centroid.eu. for the zone name, +008 for the algorithm used in
this case it's rsasha256 and lastly a unique identifier for the key.  

Keep these keys in a private place and only pull them out when you are going
to re-sign the zone, as shown in #6.3.  Also, and this is important, save the
output of dd-convert.rb so that you know which is the ZSK and which is the
KSK.

6.3 re-signing with existing keys
---------------------------------

In order to do the monthly re-signing you must know which key is the ZSK and
which is the KSK.  The initial -Z -K options of dd-convert.rb will tell which
one is which.

	./dd-convert.rb -z Kcentroid.eu.+008+04815 -k Kcentroid.eu.+008+40405 \
		-i centroid.eu -n centroid.eu

Note, this will overwrite any centroid.eu.signed file.


6.4 What to do with the .signed file
------------------------------------

Install the .signed file as your zone.  I personally use include's in my 
configfile so that this is managed easy.  Then restart delphinusdnsd after
setting the 'dnssec' option.  Your zone should talk DNSSEC, after you upload
the KSK to your registrar.  They'll likely want the DNSKEY and in some cases
grab it themselves over the insecure channel.  My registrar joker.com did 
this.  Other than that the dnssec-keysign program that dd-convert.rb uses 
creates a dsset-centroid.eu. file which has the uploadable DS keys in it.
It's up to you to upload DS or DNSKEY (which can derive DS keys) to your 
registrar and from there to your parent zone.


6.5 How can I sub-delegate a zone with DNSSEC
---------------------------------------------

You can't in delphinusdnsd 1.0.0.  Sorry.  You'll have to delegate non-signed
or keep DNSSEC off.  Patches sent in are always welcome to make this work.
Maybe for 1.1.0.


7. WHAT IT CAN'T DO
-------------------

* Solaris.  Unless you port some functions to solaris it won't compile on
there.
